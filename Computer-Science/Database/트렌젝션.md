# 트렌젝션

> 트랜잭션은 하나의 논리적인 작업 단위로, 
> 여러 개의 SQL 연산을 하나의 묶음으로 처리하여,
> 전부 성공하거나, 전부 실패(롤백)하도록 보장하는 기능.


### 🎯 트랜잭션의 핵심 목표: ACID
| 속성 (ACID)          | 설명                                                                          |
|----------------------|-------------------------------------------------------------------------------|
| 원자성 (Atomicity)   | 트랜잭션의 모든 작업은 **전부 성공하거나 전부 실패**해야 함                   |
| 일관성 (Consistency) | 트랜잭션 전과 후에 **데이터 무결성 제약조건이 항상 만족**되어야 함            |
| 격리성 (Isolation)   | 여러 트랜잭션이 동시에 실행되어도 서로 **간섭 없이 독립적**으로 수행되어야 함 |
| 지속성 (Durability)  | 일단 커밋된 데이터는 시스템이 다운돼도 **영구적으로 보존**되어야 함           |


### 💡 트랜잭션 예시: 은행 계좌 이체
```SQL
BEGIN;

UPDATE accounts SET balance = balance - 10000 WHERE id = 1; -- 송금자 출금
UPDATE accounts SET balance = balance + 10000 WHERE id = 2; -- 수신자 입금

COMMIT;
```
- 두 쿼리가 모두 성공해야만 이체가 완료됨
- 만약 중간에 오류 발생 시 ROLLBACK;을 통해 원래대로 복구


### 🧾 트랜잭션 제어 명령어 (TCL)
| 명령어                    | 설명                                 |
|---------------------------|--------------------------------------|
| BEGIN / START TRANSACTION | 트랜잭션 시작                        |
| COMMIT                    | 변경 사항을 영구 반영 (성공 처리)    |
| ROLLBACK                  | 트랜잭션 중 변경 사항을 모두 취소    |
| SAVEPOINT                 | 중간 지점 설정 (부분 ROLLBACK 가능)  |
| SET TRANSACTION           | 격리 수준 설정                       |


### 🔐 격리 수준 (Isolation Level)
| 수준               | 허용하는 동시성 문제         | 설명                              |
|--------------------|------------------------------|-----------------------------------|
| READ UNCOMMITTED   | DIRTY READ 가능              | 커밋되지 않은 데이터 읽기 허용    |
| READ COMMITTED     | 없음                         | 커밋된 데이터만 읽기              |
| REPEATABLE READ    | 팬텀 리드 발생 가능          | 같은 쿼리를 반복하면 결과는 동일  |
| SERIALIZABLE       | 없음                         | 트랜잭션 완전 직렬화 (가장 안전)  |


### ✅ 트랜잭션이 중요한 이유
- 금융, 예약, 쇼핑몰 등에서 데이터의 일관성과 안정성 유지
- 에러 발생 시 자동 복구 가능 → 데이터 신뢰도 향상
- 동시에 여러 사용자 요청을 처리해도 무결성 유지


### 📌 요약
- 트랜잭션은 여러 SQL 작업을 하나로 묶는 논리적 단위
- 반드시 ACID 특성을 만족해야 신뢰성 있는 데이터 처리가 가능
- COMMIT과 ROLLBACK으로 데이터 처리 상태를 명확히 관리
- 격리 수준은 성능과 일관성 사이의 균형을 결정


