# 정규화


### 🧠 정규화(Normalization)란?
- 정규화는 데이터베이스 설계 시 데이터 중복을 줄이고, 데이터 무결성을 높이기 위해 테이블을 체계적으로 분해하는 과정입니다.
  - 중복 데이터를 제거하여 저장 공간 절약
  - 데이터 삽입, 삭제, 수정 시 발생할 수 있는 이상 현상(Anomalies) 방지
  - 데이터 구조를 명확하게 만들어 유지보수 용이

#### 이상현상(Anomalies)
- 삽입 이상 : 데이터 삽입 시 의도와 상관없는 데이터도 함께 삽입되는 문제
- 삭제 이상 : 데이터 삽입 시 의도와 상관없는 데이터도 함께 삭제되는 문제
- 수정 이상 : 데이터 삽입 시 의도와 상관없는 데이터도 함께 수정되는 문제


### ⚙️ 정규화 과정과 단계
1. 제1정규형(1NF)
  - 모든 컬럼이 **원자값(Atomic value)**을 가져야 한다 (즉, 컬럼에 복합값이나 반복 그룹 불가)
  - 테이블 내 중복된 행 없어야 함
2. 제2정규형(2NF)
  - 1NF를 만족하고,
  - 부분 함수 종속성(Primary Key의 일부 컬럼에만 종속) 제거
  - 즉, 기본키가 복합키일 때, 기본키의 일부가 아닌 모든 컬럼이 기본키 전체에 종속해야 함
3. 제3정규형(3NF)
  - 2NF를 만족하고,
  - 이행 함수 종속성(Non-key 컬럼이 다른 Non-key 컬럼에 종속) 제거
  - 즉, 기본키가 아닌 컬럼이 다른 컬럼을 결정하면 안 됨


### 🧩 간단한 예시
#### 정규화 전 테이블 (비정규화)
```sql
| 고객ID | 이름   | 전화번호         | 상품명           | 고객등급 |
|--------|--------|------------------|------------------|----------|
| 1      | 홍길동 | 010-1234-5678    | 노트북, 마우스   | GOLD     |
```
- 💥 비원자값(상품명) 때문에 쿼리, 수정, 삭제 시 혼란 발생

#### 1NF 적용
```sql
| 고객ID | 이름   | 전화번호       | 상품명  | 고객등급 |
|--------|--------|----------------|---------|----------|
| 1      | 홍길동 | 010-1234-5678  | 노트북  | GOLD     |
| 1      | 홍길동 | 010-1234-5678  | 마우스  | GOLD     |
```
- ✅ 상품 정보가 원자값으로 분리됨 → 질의/수정 용이
- 기본 키: (고객ID, 상품명)
- 💥 고객명, 전화번호는 고객ID에만 종속 → 부분 종속 → 수정/삽입/삭제 이상 발생
  - 삽입 이상: 상품 없이 고객만 추가 불가
  - 수정 이상: 홍길동의 등급이 바뀌면 여러 행 수정해야 함
  - 삭제 이상: 마지막 주문 삭제 시 고객 정보까지 사라짐

#### 2NF 적용 후 테이블 분리
```sql
// 고객 테이블
| 고객ID | 고객명 | 전화번호       | 고객등급 |
|--------|--------|----------------|----------|
| 1      | 홍길동 | 010-1234-5678  | GOLD     |
```
```sql
// 구매 테이블
| 고객ID | 상품명 |
|--------|--------|
| 1      | 노트북 |
| 1      | 마우스 |
```
- ✅ 고객 정보는 한 번만 저장됨 → 중복 제거 및 무결성 유지 -> 삽입/수정/삭제 이상 해결됨
  - 기본 키가 주문ID라고 생각할 수 있지만, 상품이 여러 개인 경우 고객명, 상품명이 복합키가 될 수 있습니다. 
  - 고객 정보는 상품명과 무관하므로 부분 종속성 발생 → 고객 정보를 분리해야 합니다.
- 💥 고객 테이블이 아직 3NF를 위반하고 있는 경우
  - 예를 들어, 고객등급에 따라 할인율이 정해진다고 해봅시다.
  - 여기서 **고객등급 → 할인율**이라는 **이행 종속성**이 생깁니다.
  - 즉, 고객ID → 고객등급 → 할인율

#### 3NF 적용
```sql
// 고객 테이블
| 고객ID | 고객명 | 전화번호       | 고객등급 |
|--------|--------|----------------|----------|
| 1      | 홍길동 | 010-1234-5678  | GOLD     |
```
```sql
// 등급 테이블
| 고객등급 | 할인율 |
|----------|--------|
| GOLD     | 10%    |
| SILVER   | 5%     |
```
- ✅ 고객등급과 할인율을 분리해서 고객 테이블을 더 정규화합니다.
  - 이렇게 함으로써 할인율을 한 군데만 관리하면 되므로 수정 이상이 제거됨

#### 요약: 정규화가 해결하는 이상 현상
| 정규화 단계 | 해결하는 이상현상                      | 주요 조치                         |
|-------------|----------------------------------------|-----------------------------------|
| 1NF         | 비원자값(반복 그룹) → 수정/질의 어려움 | 컬럼 값들을 원자값으로 분리       |
| 2NF         | 부분 종속성 → 중복/삽입/삭제 이상      | 부분 종속 제거, 테이블 분리       |
| 3NF         | 이행 종속성 → 중복/수정 이상           | 비키 종속 제거, 테이블 분리       |


### 📌 정규화의 이점과 단점
| 이점                                         | 단점                                             |
|----------------------------------------------|--------------------------------------------------|
| 데이터 중복 최소화                           | 과도한 정규화는 조인(Join) 연산 증가로 성능 저하 |
| 데이터 무결성 향상                           | 설계와 관리가 복잡해질 수 있음                   |
| 갱신 이상(Insert/Update/Delete Anomaly) 방지 | 일부 상황에서는 비정규화가 더 효율적일 수 있음   |
